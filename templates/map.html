<!DOCTYPE html>
<html>
<head>
    <title>Live Updating Map</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.js"></script>
</head>
<body>
    <h2>Live Updating Map with Flask WebSockets</h2>
    <div id="map" style="width: 100%; height: 90vh;"></div>

    <script>
        // Alustetaan Leaflet-kartta
        var map = L.map('map').setView([60.1695, 24.9354], 12);

        // Lis√§√§ OpenStreetMap-taustakartta
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19
        }).addTo(map);

        // Lis√§t√§√§n markkeri lentokoneelle
        var marker = L.marker([60.1695, 24.9354]).addTo(map);

        // Alustetaan WebSocket-yhteys Flask-palvelimeen
        var socket = io.connect("http://127.0.0.1:5000");

        // Kuunnellaan WebSocketia, kun uusi sijainti saapuu
        socket.on("location_update", function(data) {
            console.log("üì° Uusi sijainti WebSocketin kautta:", data.lat, data.lon);

            // P√§ivit√§ markkeri ja siirr√§ kartta uuteen sijaintiin
            marker.setLatLng([data.lat, data.lon]);
            map.panTo([data.lat, data.lon]);  // Siirret√§√§n n√§kym√§ uuteen sijaintiin
        });
    </script>
</body>
</html>
